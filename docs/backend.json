{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "avatarUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL for the user's avatar image."
        },
        "role": {
          "type": "string",
          "description": "The user's role in the system.",
          "enum": ["Gestor", "Funcion√°rio"]
        }
      },
      "required": [
        "id",
        "name",
        "email"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a project within the task and project funnel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project."
        },
        "name": {
          "type": "string",
          "description": "Name of the project."
        },
        "description": {
          "type": "string",
          "description": "Description of the project."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the project.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the project.",
          "format": "date-time"
        },
        "ownerId": {
            "type": "string",
            "description": "Reference to a User who is the project owner."
        },
        "teamMembers": {
            "type": "array",
            "description": "References to Users who are part of the project team.",
            "items": {
                "type": "string"
            }
        },
        "contactPhone": {
            "type": "string",
            "description": "Contact phone for the project."
        },
        "technicalDetails": {
            "type": "string",
            "description": "Technical specifications and details of the project."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "startDate",
        "ownerId"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task within a project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task."
        },
        "name": {
          "type": "string",
          "description": "Name of the task."
        },
        "description": {
          "type": "string",
          "description": "Description of the task."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Task)"
        },
        "stageId": {
          "type": "string",
          "description": "Reference to Stage. (Relationship: Stage 1:N Task)"
        },
        "isCompleted": {
          "type": "boolean",
          "description": "Indicates whether the task is completed."
        },
        "dependentTaskIds": {
          "type": "array",
          "description": "References to other Tasks that must be completed before this task can be started. (Relationship: Task 1:N Task)",
          "items": {
            "type": "string"
          }
        },
        "assigneeId": {
            "type": "string",
            "description": "Reference to a User who is responsible for the task."
        },
        "dueDate": {
            "type": "string",
            "description": "The due date for the task.",
            "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "projectId",
        "stageId",
        "isCompleted"
      ]
    },
    "Stage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stage",
      "type": "object",
      "description": "Represents a stage in the project funnel. Stages contain tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stage."
        },
        "name": {
          "type": "string",
          "description": "Name of the stage."
        },
        "description": {
          "type": "string",
          "description": "Description of the stage."
        },
        "order": {
          "type": "number",
          "description": "The order of the stage in the funnel.  Lower numbers mean earlier in the funnel."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "order"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Represents a user of the application. Contains profile information.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, typically the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Represents a project. Includes the 'id', 'name', 'description', 'startDate', 'endDate', 'ownerId', 'teamMembers', 'contactPhone', 'technicalDetails'.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/stages/{stageId}",
        "definition": {
          "entityName": "Stage",
          "schema": {
            "$ref": "#/backend/entities/Stage"
          },
          "description": "Represents a stage within a project. Contains 'id', 'name', 'description', and 'order'.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "stageId",
              "description": "The unique identifier for the stage."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Represents a task within a stage. Contains 'id', 'name', 'description', 'projectId', 'stageId', 'isCompleted', 'assigneeId', 'dueDate', and 'dependentTaskIds'.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "taskId",
              "description": "The unique identifier for the task."
            }
          ]
        }
      }
    ],
    "reasoning": "This design prioritizes authorization independence and QAPs. Projects, Stages, and Tasks are organized in a hierarchy, enabling straightforward ownership-based security rules. Authorization Independence is achieved by avoiding `get()` calls in security rules. The structure supports CRUD operations and enables atomic operations (transactions/batches) for related data.\n\n*   **Users**: A top-level `/users` collection stores public user data, allowing profiles to be fetched easily.\n*   **Projects**: Located at the root collection `/projects/{projectId}`. This allows listing all projects, filtering based on project properties, and securing individual projects.\n*   **Stages:** Stages related to each Project are stored in a subcollection `/projects/{projectId}/stages/{stageId}`.  This enables listing stages related to a project, filtering based on stage properties, and securing individual stages.\n*   **Tasks:** Tasks for each stage are stored in a subcollection `/projects/{projectId}/tasks/{taskId}`. This enables listing tasks related to a stage, filtering based on task properties, and securing individual tasks.\n\nThis structure facilitates conditional stage advancement as it provides easy access to tasks within each stage. Security rules can easily verify task completion status within a stage before allowing a project to advance."
  }
}
